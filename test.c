#include <assert.h> // assert
#include <string.h> // memcpy
#include <stdio.h>
#include <stdlib.h>
#include <inttypes.h>
#include <time.h>
#include <math.h>

#define N 9

//Serpent S0
int sbox[1<<N];

int sbox_DDT[(1<<N)][(1<<N)]; //it stores the DDT of the S-box that we get

// building the DDT for S-box. Returns differential uniformity of the S-box
int DDTInformation() {
    int diffuniform = 0;
    // for all input differences a
    for (int a=0;a<(1<<N);a++)
    {
        for (int i=0;i<(1<<N);i++) 
        {
            sbox_DDT[a][sbox[i]^sbox[i^a]]+=1;
            // if set above 2, return that it cannot be APN anymore
            if (sbox_DDT[a][sbox[i]^sbox[i^a]]>diffuniform && a!=0) 
                diffuniform = sbox_DDT[a][sbox[i]^sbox[i^a]];
        }
    }
    return diffuniform;
}


// yes




int main()
{
    int index[1<<9] ={448, 269, 273, 333, 412, 476, 337, 384, 90, 151, 139, 215, 6, 70, 203, 26, 98, 175, 179, 239, 62, 126, 243, 34, 218,
    23, 11, 87, 134, 198, 75, 154, 376, 437, 425, 501, 292, 356, 489, 312, 504, 309, 297, 373, 420, 484, 361, 440, 226, 47, 
    51, 111, 190, 254, 115, 162, 320, 397, 401, 461, 284, 348, 465, 256, 213, 24, 4, 88, 137, 201, 68, 149, 335, 386, 414,
    450, 275, 339, 478, 271, 375, 442, 422, 506, 299, 363, 486, 311, 463, 258, 286, 322, 403, 467, 350, 399, 109, 160, 188, 
    224, 49, 113, 252, 45, 237, 32, 60, 96, 177, 241, 124, 173, 503, 314, 294, 378, 427, 491, 358, 439, 85, 152, 132, 216,
    9, 73, 196, 21, 165, 104, 116, 40, 249, 185, 52, 229, 319, 498, 494, 434, 355, 291, 430, 383, 263, 458, 470, 394, 347,
    283, 406, 327, 447, 370, 366, 306, 483, 419, 302, 511, 29, 208, 204, 144, 65, 1, 140, 93, 157, 80, 76, 16, 193, 129, 12,
    221, 391, 330, 342, 266, 475, 411, 278, 455, 37, 232, 244, 168, 121, 57, 180, 101, 469, 280, 260, 344, 393, 457, 324,
    405, 79, 130, 158, 194, 19, 83, 222, 15, 119, 186, 166, 250, 43, 107, 230, 55, 207, 2, 30, 66, 147, 211, 94, 143, 365,
    416, 444, 480, 305, 369, 508, 301, 493, 288, 316, 352, 433, 497, 380, 429, 247, 58, 38, 122, 171, 235, 102, 183, 341,
    408, 388, 472, 265, 329, 452, 277, 176, 125, 97, 61, 236, 172, 33, 240, 298, 487, 507, 423, 374, 310, 443, 362, 274,
    479, 451, 415, 334, 270, 387, 338, 426, 359, 379, 295, 502, 438, 315, 490, 8, 197, 217, 133, 84, 20, 153, 72, 136, 69,
    89, 5, 212, 148, 25, 200, 402, 351, 323, 287, 462, 398, 259, 466, 48, 253, 225, 189, 108, 44, 161, 112, 432, 381, 353,
    317, 492, 428, 289, 496, 42, 231, 251, 167, 118, 54, 187, 106, 18, 223, 195, 159, 78, 14, 131, 82, 170, 103, 123, 39,
    246, 182, 59, 234, 264, 453, 473, 389, 340, 276, 409, 328, 392, 325, 345, 261, 468, 404, 281, 456, 146, 95, 67, 31, 206,
    142, 3, 210, 304, 509, 481, 445, 364, 300, 417, 368, 421, 360, 372, 296, 505, 441, 308, 485, 63, 242, 238, 178, 99, 35, 
    174, 127, 7, 202, 214, 138, 91, 27, 150, 71, 191, 114, 110, 50, 227, 163, 46, 255, 285, 464, 460, 400, 321, 257, 396,
    349, 413, 336, 332, 272, 449, 385, 268, 477, 135, 74, 86, 10, 219, 155, 22, 199, 293, 488, 500, 424, 377, 313, 436, 357,
    192, 13, 17, 77, 156, 220, 81, 128, 346, 407, 395, 471, 262, 326, 459, 282, 354, 431, 435, 495, 318, 382, 499, 290, 474,
    279, 267, 343, 390, 454, 331, 410, 120, 181, 169, 245, 36, 100, 233, 56, 248, 53, 41, 117, 164, 228, 105, 184, 482, 303,
    307, 367, 446, 510, 371, 418, 64, 141, 145, 205, 28, 92, 209, 0};

    int box[1<<9] = {320, 246, 58, 106, 332, 349, 55, 448, 319, 125, 440, 329, 402, 43, 29, 23, 274, 237, 4, 464, 154, 298, 424, 51, 135,
1, 313, 117, 407, 366, 476, 239, 109, 162, 447, 375, 249, 417, 251, 420, 207, 452, 36, 337, 486, 510, 32, 70, 392, 435, 
423, 462, 445, 333, 331, 489, 192, 178, 131, 366, 369, 32, 462, 256, 307, 450, 228, 489, 98, 196, 94, 260, 477, 472,
503, 91, 45, 291, 229, 66, 317, 389, 134, 15, 488, 239, 413, 171, 180, 373, 423, 438, 249, 183, 501, 107, 2, 394, 381,
232, 459, 36, 142, 380, 113, 61, 55, 31, 5, 170, 132, 79, 374, 10, 500, 192, 30, 89, 431, 416, 98, 343, 140, 60, 142,
360, 374, 277, 164, 376, 406, 57, 343, 155, 70, 505, 86, 382, 153, 407, 260, 352, 225, 163, 234, 383, 436, 415, 157,
240, 453, 22, 434, 350, 68, 247, 349, 121, 380, 7, 324, 481, 222, 489, 47, 170, 71, 336, 442, 219, 281, 403, 364, 169,
192, 238, 44, 125, 75, 477, 486, 203, 378, 400, 376, 352, 371, 353, 310, 442, 483, 357, 387, 397, 134, 38, 383, 89, 444,
52, 416, 346, 344, 345, 509, 371, 458, 447, 348, 283, 53, 273, 36, 163, 174, 330, 137, 439, 328, 244, 361, 167, 154,
470, 238, 409, 323, 379, 138, 229, 304, 16, 221, 110, 73, 460, 260, 43, 378, 355, 343, 212, 263, 414, 402, 85, 220, 1,
146, 344, 174, 435, 467, 437, 212, 101, 279, 371, 90, 261, 20, 239, 189, 381, 441, 297, 265, 247, 27, 328, 70, 123, 468,
505, 245, 46, 339, 9, 435, 31, 204, 408, 325, 262, 211, 192, 330, 78, 183, 426, 338, 149, 300, 158, 252, 404, 216, 1, 4,
126, 254, 12, 234, 187, 387, 106, 411, 253, 185, 163, 413, 264, 90, 506, 46, 204, 228, 351, 393, 368, 434, 297, 45, 223,
284, 103, 330, 88, 465, 446, 435, 480, 478, 269, 380, 403, 416, 370, 83, 293, 138, 80, 149, 491, 228, 335, 447, 81, 342,
197, 48, 486, 78, 428, 377, 275, 120, 74, 343, 237, 97, 71, 111, 440, 490, 152, 257, 386, 439, 161, 381, 438, 288, 186, 
251, 188, 191, 480, 25, 342, 428, 407, 62, 21, 113, 338, 401, 403, 47, 99, 449, 172, 78, 409, 83, 240, 177, 341, 427,
315, 238, 388, 354, 228, 308, 217, 147, 402, 490, 505, 206, 464, 168, 12, 118, 479, 461, 407, 133, 31, 267, 14, 412, 89,
371, 237, 258, 37, 8, 77, 347, 423, 104, 198, 221, 230, 15, 162, 108, 84, 493, 266, 308, 139, 14, 258, 36, 112, 384,
201, 40, 469, 33, 432, 421, 128, 306, 143, 359, 59, 50, 11, 322, 410, 259, 3, 199, 190, 294, 278, 235, 418, 202, 179,
422, 327, 119, 270, 195, 290, 241, 193, 497, 148, 456, 272, 309, 184, 19, 487, 42, 242, 151, 271, 430, 282, 473, 285,
292, 224, 65, 305, 72, 56, 64, 205, 209, 145, 92, 141, 28, 0};

    for (int i=0;i<(1<<9);i++)
        sbox[index[i]]=box[i];
    printf("Differential Uniformity is %d\n",DDTInformation());
    
    printf("sbox is:\n ");
    for (int i=0;i<(1<<9);i++)
        printf("%d,",sbox[i]);
    
    printf("\nEND\n ");
}